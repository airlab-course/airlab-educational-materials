# Сервопривод
*Привод с управлением через отрицательную обратную связь, позволяющую точно управлять параметрами движения*

## Оглавление
1. [Примеры подключения к Arduino](#connection-example)
1. [Особенности работы](#features)
2. [Управление сервоприводом через библиотеку Servo](#control)
3. [Пример использования библиотеки Servo](#example)
4. [Устройство сервопривода](#device)
5. [Применение](#application)
6. [Проблемы](#problems)
7. [Ссылки](#links)

<a name="connection-example"></a>
## Примеры подключения к Arduino

![](images/connection.jpg) 

<a name="features"></a>
## Особенности работы
Сервопривод — это привод, в котором используется отрицательная обратная связь, позволяющая точно управлять параметрами движения исполнительного звена привода (чаще всего это выходной вал). Для создания такой обратной связи обычно используется датчик положения выходного звена сервопривода, но могут применяться и датчики скорости, усилия и т. д. Получается, что сервопривод — это привод, на который подается сигнал, указывающий выдвинуться или повернуться в определенное положение. Он в это положение устанавливается и «ждет», пока не поступит команда об изменении положения. Например, подается сигнал об установке вала в угловое положение 90 градусов. Вал поворачивается в это положение и держит его, пока не придет сигнал о новом положении. Такие возможности управления серьезно отличают сервопривод от обычного мотор-редуктора, который способен только непрерывно вращаться, пока на него подано напряжение. В результате, если такими приводами оснащен робот, то он может двигаться подобно руке человека и выполнять всю ту работу, которую можем выполнять мы.

<a name="control"></a>
## Управление сервоприводом через библиотеку Servo

Управление сервоприводом через библиотеку основано на следующих командах:
- ```attach(pin)``` — позволяет подключить определенный сервопривод к соответствующему пину;
  - pin - Обязательный параметр. Цифровой пин к которому подключен сигнальный провод сервопривода.
- ```write(angle)``` — на пин поступают значения для управления им;
  - angle - Обязательный параметр. Устанавливает угол от 0 до 180 градусов. При использовании сервопривода постоянного вращения значение 90 используется для неподвижного состояния. Значение 0 для максимальной скорости кручения в одну сторону, а 180 для максимальной скорости кручения в другую сторону.
- ```writeMicroseconds(ms)``` — позволяет управлять сервоприводом путем передачи на него значений в микросекундах; 
  - ms - Обязательный параметр. Значение в микросекундах
- ```read()``` — считывает значение текущего положения сервопривода;
- ```attached()``` — контролирует подключение сервопривода к пину;
- ```detach()``` — отключает сервопривод от конкретного пина.

<a name="features"></a>
## Пример использования библиотеки Servo

```c++
#include <Servo.h>
 
Servo myservo;
 
void setup() {
 Serial.begin(9600); // Открываем последовательный порт
 myservo.attach(9); // Указываем пин если этого не было сделано раньше
 int position = myservo.read(); // Считываем положение сервопривода
 Serial.print("Текущее положение сервопривода: ");

 Serial.println(position); // Отправляем значение угла на запись в последовательный порт
 myservo.write(90); // Поворачивает сервопривод на среднее положение
 myservo.detach(); // Освобождаем пин, к которому был подключен сервопривод
}
 
void loop() {
 // CODE...
}
```


<a name="device"></a>
## Устройство сервопривода
В его состав входит электродвигатель, редуктор с набором шестеренок, потенциометр (выполняет функцию датчика положения для обратной связи), электронная плата управления электродвигателем и корпус, в который заключено все содержимое. 
![](images/servos.jpg)

Провод, посредством которого сервопривод питается и управляется. Он состоит из 3-х жил: питание «плюс», питание «минус» и провод, на который подается управляющий сигнал. На разных моделях сервоприводов провода могут иметь разный цвет. Но практически всегда провод питания «плюс» окрашен в красный цвет, а провод питания «минус» - в черный. В отношении же сигнального провода (для передачи управляющего сигнала) четких цветовых стандартов нет. У разных производителей сервоприводов сигнальный провод может быть белым, оранжевым или желтым.
![](images/servos-wires.jpg)

Для управления такими двигателями принят стандарт управляющего сигнала. Он представляет собой постоянно повторяющиеся импульсы. Частота этих импульсов все время остается постоянной и составляет 50 Гц. Получается, что временной период импульсов (время между передними фронтами соседних импульсов) составляет 1с/50 = 0,02 секунды.

Что интересно, угловое положение выходного вала сервопривода задается продолжительностью подаваемого импульса. Для пояснения на рисунке показано приблизительное соотношение ширины импульса во временных координатах и угла поворота вала сервопривода. 
![](images/servos-pwm.jpg)

Как видно из графика, для управления сервоприводом используется не что иное как сигнал с [широтно импульсной модуляцией - ШИМ](../PWM/PWM.md).



<a name="problems"></a>
## Проблемы

**Невозможность поворота на заданный угол**
- Бывают случаи, когда поворот сервопривода на заданный угол невозможен. Например, на его пути возникает какая-либо преграда. Этой преградой может стать закрепленное на сервоприводе устройство или его часть. Упираясь в преграду, сервопривод начинает характерно жужжать. Чтобы решить данную проблему, в программу вносятся команды, ограничивающие перемещение сервопривода путем изменения угла перемещения. 

**Настройки начальной и конечной позиции**
-  Иногда необходимо подкорректировать координаты начальной или конечной позиции. Это нужно когда значения датчика и фактического положения выходного вала расходятся относительно конечной позиции последнего. Например, выходной вал находится в конечной позиции, но датчик считает, что он еще ее не достиг и пытается заставить выходной вал продолжить движение. Возникает характерный шум. В этом случае начальная позиция не обязательно должна начинаться с 0°С, а конечная не обязательно должна заканчиваться на 180°C. Эти предельные значения можно немного сдвинуть на 5-10°C, и проблема будет решена.



<a name="application"></a>
## Применение
Сервопривод чаще всего встречается в робототехнике. Без него невозможно обойтись, особенно когда речь идет о решении задачи точного перемещения грузов или предметов. Такая задача возникает при выполнении какой-либо механической работы (покраска, сварка, шлифовка, перемещение изделий на конвейере и т.  д.). Выполняют такую работу манипуляторы, которые выглядят как механические руки. Собственно говоря, знаменитая промышленная робототехника, которая используется для автоматизации производства по всему миру, представлена прежде всего манипуляторами.


<a name="links"></a>
## Ссылки
1. [Библиотека Servo](https://www.arduino.cc/en/Reference/Servo)